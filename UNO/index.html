<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UNO Online</title>
<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Russo+One&family=Poppins:wght@400;600;700;800;900&display=swap');

:root {
  --red:#DC2626;--blue:#2563EB;--green:#16A34A;--yellow:#EAB308;
  --black:#1a1a2e;--bg:#1a3a5c;--bg2:#0f2940;
  --card-w:110px;--card-h:160px;
  --card-w-sm:80px;--card-h-sm:116px;
  --back-w:70px;--back-h:100px;
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:'Poppins',sans-serif;
  background:var(--bg);color:#fff;
  min-height:100vh;overflow:hidden;
  background-image:
    repeating-linear-gradient(45deg,transparent,transparent 35px,rgba(255,255,255,.015) 35px,rgba(255,255,255,.015) 70px),
    radial-gradient(ellipse at 50% 50%,#1e4976 0%,#0d2137 100%);
}

/* ==================== ANIMATIONS ==================== */
@keyframes fadeIn{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
@keyframes scaleIn{from{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}
@keyframes slideUp{from{opacity:0;transform:translateY(40px)}to{opacity:1;transform:translateY(0)}}
@keyframes cardPop{0%{transform:scale(1)}50%{transform:scale(1.08) rotate(2deg)}100%{transform:scale(1)}}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
@keyframes glow{0%,100%{filter:drop-shadow(0 0 8px rgba(46,204,113,.3))}50%{filter:drop-shadow(0 0 20px rgba(46,204,113,.7))}}
@keyframes rainbow{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
@keyframes confetti{0%{transform:translateY(0) rotate(0);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}
@keyframes arrowBounce{0%,100%{transform:translateX(0) scale(1)}50%{transform:translateX(4px) scale(1.15)}}
@keyframes arrowBounceL{0%,100%{transform:translateX(0) scale(1) scaleX(-1)}50%{transform:translateX(-4px) scale(1.15) scaleX(-1)}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
@keyframes dotPulse{0%,100%{opacity:.3}50%{opacity:1}}
@keyframes cardDeal{from{opacity:0;transform:translateY(-60px) scale(.6)}to{opacity:1;transform:translateY(0) scale(1)}}
@keyframes shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}

.screen{display:none;width:100%;height:100vh;flex-direction:column;align-items:center;justify-content:center}
.screen.active{display:flex}

/* ==================== MENU ==================== */
.menu-bg{
  position:fixed;inset:0;
  background:
    repeating-linear-gradient(45deg,transparent,transparent 35px,rgba(255,255,255,.012) 35px,rgba(255,255,255,.012) 70px),
    radial-gradient(ellipse at 30% 40%,#1e4d6e 0%,transparent 60%),
    radial-gradient(ellipse at 70% 70%,#162544 0%,transparent 60%),
    #0d1f33;
  z-index:-1;
}
.menu-logo{
  font-family:'Russo One',sans-serif;font-size:5rem;letter-spacing:2px;
  text-shadow:0 4px 0 #c0392b,0 8px 20px rgba(0,0,0,.5);
  color:#fff;margin-bottom:4px;position:relative;
}
.menu-logo .logo-u{color:var(--red)}
.menu-logo .logo-n{color:var(--yellow)}
.menu-logo .logo-o{color:var(--green)}
.menu-sub{color:rgba(255,255,255,.5);font-size:.85rem;margin-bottom:32px;font-weight:400}

.panel{
  background:rgba(0,0,0,.35);backdrop-filter:blur(16px);
  border:1px solid rgba(255,255,255,.08);border-radius:18px;
  padding:32px;max-width:420px;width:92%;
}
.panel h2{font-size:1.05rem;font-weight:700;margin-bottom:18px;text-align:center}
.panel p{font-size:.8rem;color:rgba(255,255,255,.5);text-align:center;margin-bottom:14px;line-height:1.5}

.field{position:relative;margin-bottom:12px}
.field input,.field select{
  width:100%;padding:12px 14px 12px 40px;border-radius:12px;
  border:1px solid rgba(255,255,255,.1);background:rgba(0,0,0,.3);
  color:#fff;font-family:'Poppins',sans-serif;font-size:.85rem;
  outline:none;transition:all .25s;
}
.field input:focus,.field select:focus{border-color:rgba(52,152,219,.5);box-shadow:0 0 0 3px rgba(52,152,219,.12)}
.field input::placeholder{color:rgba(255,255,255,.2)}
.field .fi{position:absolute;left:12px;top:50%;transform:translateY(-50%);font-size:.9rem;opacity:.4}
.field select option{background:#1a1a2e;color:#fff}

.btn{
  width:100%;padding:13px;border-radius:13px;border:none;
  font-family:'Poppins',sans-serif;font-size:.9rem;font-weight:700;
  cursor:pointer;transition:all .25s;letter-spacing:.3px;color:#fff;
}
.btn:hover{transform:translateY(-2px)}
.btn:active{transform:translateY(0)}
.btn:disabled{opacity:.35;cursor:not-allowed;transform:none!important}
.btn-blue{background:linear-gradient(135deg,#2563eb,#7c3aed);box-shadow:0 4px 15px rgba(37,99,235,.3)}
.btn-blue:hover:not(:disabled){box-shadow:0 8px 25px rgba(37,99,235,.5)}
.btn-green{background:linear-gradient(135deg,#16a34a,#059669);box-shadow:0 4px 15px rgba(22,163,74,.3)}
.btn-green:hover:not(:disabled){box-shadow:0 8px 25px rgba(22,163,74,.5)}
.btn-red{background:linear-gradient(135deg,#dc2626,#b91c1c);box-shadow:0 4px 15px rgba(220,38,38,.3)}
.btn-sm{width:auto;padding:8px 16px;font-size:.75rem;border-radius:10px}

.tabs{display:flex;gap:4px;margin-bottom:16px;background:rgba(0,0,0,.2);border-radius:12px;padding:3px}
.tab{
  flex:1;padding:9px;border-radius:10px;border:none;background:transparent;
  color:rgba(255,255,255,.5);font-family:'Poppins',sans-serif;font-size:.8rem;
  font-weight:600;cursor:pointer;transition:all .25s;text-align:center;
}
.tab.on{background:linear-gradient(135deg,#2563eb,#7c3aed);color:#fff}

.divider{display:flex;align-items:center;gap:10px;margin:16px 0;color:rgba(255,255,255,.25);font-size:.7rem}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:rgba(255,255,255,.08)}

.code-box{
  background:rgba(0,0,0,.4);border:2px dashed rgba(255,255,255,.12);
  border-radius:14px;padding:18px;text-align:center;margin:14px 0;
}
.code-box label{font-size:.6rem;text-transform:uppercase;letter-spacing:2px;color:rgba(255,255,255,.4);display:block;margin-bottom:6px}
.code-box .code{font-family:'Russo One',sans-serif;font-size:2rem;letter-spacing:6px;color:#EAB308}
.code-box .copy{font-size:.7rem;color:rgba(255,255,255,.4);margin-top:6px;cursor:pointer}
.code-box .copy:hover{color:#fff}

.lobby-list{margin:12px 0;max-height:180px;overflow-y:auto}
.lp{
  display:flex;align-items:center;gap:10px;padding:9px 12px;
  background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06);
  border-radius:10px;margin-bottom:6px;font-size:.82rem;animation:fadeIn .3s ease;
}
.lp-ava{width:30px;height:30px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:.9rem;flex-shrink:0}
.lp-name{flex:1;font-weight:500}
.lp-badge{font-size:.55rem;padding:2px 7px;border-radius:5px;background:#2563eb;font-weight:700;text-transform:uppercase;letter-spacing:.5px}
.dots span{animation:dotPulse 1.2s ease infinite}
.dots span:nth-child(2){animation-delay:.2s}
.dots span:nth-child(3){animation-delay:.4s}
#conn-status{text-align:center;margin-top:12px;font-size:.72rem;color:rgba(255,255,255,.4)}

/* ==================== GAME BOARD ==================== */
#game-screen{padding:0;position:relative;overflow:hidden}
#game-screen.active{display:flex;flex-direction:column}

.game-board{
  width:100%;height:100vh;display:flex;flex-direction:column;
  position:relative;overflow:hidden;
}

/* Top: Quit button */
.quit-btn{
  position:absolute;top:12px;left:12px;z-index:50;
  display:flex;align-items:center;gap:6px;padding:8px 14px;
  background:rgba(220,38,38,.85);border:none;border-radius:8px;
  color:#fff;font-family:'Poppins',sans-serif;font-size:.72rem;font-weight:700;
  cursor:pointer;transition:all .25s;text-transform:uppercase;letter-spacing:.5px;
}
.quit-btn:hover{background:rgba(220,38,38,1);transform:scale(1.05)}
.quit-btn svg{width:14px;height:14px}

/* ==================== OPPONENT AREAS ==================== */
.opponents-section{
  display:flex;justify-content:center;align-items:flex-start;
  gap:20px;padding:10px 16px 0;flex-wrap:wrap;position:relative;z-index:10;
}

.opponent-slot{
  display:flex;flex-direction:column;align-items:center;gap:4px;
  max-width:250px;
}
.opp-label{
  font-size:.65rem;color:rgba(255,255,255,.45);font-weight:600;
  text-transform:uppercase;letter-spacing:1px;display:flex;align-items:center;gap:6px;
}
.opp-label .star{color:#EAB308;font-size:.7rem}
.opp-label.is-turn{color:var(--green);text-shadow:0 0 10px rgba(46,204,113,.5)}

.opp-hand{
  display:flex;justify-content:center;position:relative;height:var(--back-h);
  min-width:120px;
}
.card-back{
  width:var(--back-w);height:var(--back-h);border-radius:8px;
  position:absolute;transition:all .3s;cursor:default;
  border:2px solid rgba(255,255,255,.15);
  overflow:hidden;
  background:#111;
  box-shadow:0 2px 8px rgba(0,0,0,.4);
}
.card-back-inner{
  width:100%;height:100%;position:relative;overflow:hidden;
  background:repeating-linear-gradient(
    -45deg,
    #111 0px,#111 8px,
    #1a1a2e 8px,#1a1a2e 16px
  );
}
.card-back-inner::after{
  content:'';position:absolute;inset:0;
  background:
    linear-gradient(135deg,var(--red) 0%,var(--red) 25%,var(--green) 25%,var(--green) 50%,var(--blue) 50%,var(--blue) 75%,var(--yellow) 75%,var(--yellow) 100%);
  clip-path:polygon(30% 20%,70% 20%,85% 50%,70% 80%,30% 80%,15% 50%);
  opacity:.7;
}
.card-back-inner::before{
  content:'';position:absolute;inset:8px;
  border:2px solid rgba(255,255,255,.1);border-radius:4px;z-index:1;
}

/* UNO badge on opponent */
.opp-uno{
  position:absolute;top:-8px;right:-8px;z-index:5;
  background:var(--red);color:#fff;font-size:.5rem;font-weight:900;
  padding:2px 6px;border-radius:5px;letter-spacing:.5px;
  animation:pulse .8s infinite;
}

/* ==================== CENTER AREA ==================== */
.center-area{
  flex:1;display:flex;align-items:center;justify-content:center;
  gap:12px;position:relative;padding:10px;
}

/* Direction arrow */
.dir-arrow{
  position:absolute;right:20px;top:50%;transform:translateY(-50%);
  z-index:20;
}
.dir-arrow svg{
  width:40px;height:40px;filter:drop-shadow(0 2px 6px rgba(0,0,0,.4));
  animation:arrowBounce 1s ease infinite;
}
.dir-arrow.ccw svg{animation:arrowBounceL 1s ease infinite}

/* Current color diamond */
.color-diamond{
  position:absolute;left:20px;top:50%;transform:translateY(-50%);
  z-index:20;display:flex;flex-direction:column;align-items:center;gap:4px;
}
.diamond{
  width:28px;height:28px;transform:rotate(45deg);border-radius:4px;
  border:2px solid rgba(255,255,255,.3);box-shadow:0 2px 10px rgba(0,0,0,.3);
  transition:all .3s;
}
.diamond.d-red{background:var(--red)}
.diamond.d-blue{background:var(--blue)}
.diamond.d-green{background:var(--green)}
.diamond.d-yellow{background:var(--yellow)}
.color-diamond .clabel{font-size:.5rem;color:rgba(255,255,255,.35);text-transform:uppercase;letter-spacing:1px}

/* Draw + Discard Piles */
.piles{display:flex;align-items:center;gap:16px}

.draw-pile{
  position:relative;cursor:pointer;transition:all .25s;
}
.draw-pile:hover{transform:translateY(-4px)}
.draw-pile:active{transform:translateY(-1px)}
.draw-stack{position:relative;width:var(--card-w-sm);height:var(--card-h-sm)}
.draw-stack .card-back{width:var(--card-w-sm);height:var(--card-h-sm);border-radius:10px}
.draw-stack .card-back:nth-child(1){top:0;left:0;z-index:3}
.draw-stack .card-back:nth-child(2){top:3px;left:2px;z-index:2;opacity:.7}
.draw-stack .card-back:nth-child(3){top:6px;left:4px;z-index:1;opacity:.4}
.draw-count{
  position:absolute;bottom:-18px;left:50%;transform:translateX(-50%);
  font-size:.55rem;color:rgba(255,255,255,.35);white-space:nowrap;
}

.discard-pile{
  position:relative;width:var(--card-w-sm);height:var(--card-h-sm);
}

/* ==================== UNO CARD DESIGN ==================== */
.uno-card{
  border-radius:10px;position:relative;overflow:hidden;
  box-shadow:0 4px 15px rgba(0,0,0,.4);
  transition:all .25s cubic-bezier(.4,0,.2,1);
}
.uno-card.discard-top{
  width:var(--card-w-sm);height:var(--card-h-sm);
  animation:cardPop .35s ease;
}

/* Card color backgrounds - diagonal split design */
.uno-card[data-color="red"]{background:var(--red)}
.uno-card[data-color="blue"]{background:var(--blue)}
.uno-card[data-color="green"]{background:var(--green)}
.uno-card[data-color="yellow"]{background:var(--yellow)}
.uno-card[data-color="wild"]{background:linear-gradient(135deg,var(--red),var(--blue),var(--green),var(--yellow));background-size:200% 200%;animation:rainbow 3s ease infinite}

/* Inner card structure */
.card-face{
  width:100%;height:100%;position:relative;display:flex;align-items:center;justify-content:center;
}
/* Diagonal stripe */
.card-face::before{
  content:'';position:absolute;
  width:140%;height:60%;
  background:rgba(0,0,0,.2);
  transform:rotate(-30deg);
  top:20%;left:-20%;
}
/* Center diamond */
.card-center{
  position:relative;z-index:2;
  width:55%;height:45%;
  background:inherit;
  transform:rotate(45deg);
  border:3px solid rgba(255,255,255,.35);
  border-radius:6px;
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 0 10px rgba(0,0,0,.2);
}
.card-center-val{
  transform:rotate(-45deg);
  font-family:'Russo One',sans-serif;
  font-size:1.8em;
  color:#fff;
  text-shadow:1px 2px 0 rgba(0,0,0,.3);
  line-height:1;
}
.uno-card[data-color="yellow"] .card-center-val{color:#333}

/* Corner values */
.card-corner{
  position:absolute;z-index:3;
  font-family:'Russo One',sans-serif;
  font-size:.65em;
  color:#fff;
  text-shadow:1px 1px 0 rgba(0,0,0,.3);
  line-height:1;
}
.uno-card[data-color="yellow"] .card-corner{color:#333}
.card-corner.tl{top:6px;left:8px}
.card-corner.br{bottom:6px;right:8px;transform:rotate(180deg)}

/* Wild card special center */
.wild-center{
  position:relative;z-index:2;
  width:50%;height:42%;
  transform:rotate(45deg);
  border-radius:6px;overflow:hidden;
  border:3px solid rgba(255,255,255,.35);
  display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr 1fr;
}
.wild-center div:nth-child(1){background:var(--red)}
.wild-center div:nth-child(2){background:var(--blue)}
.wild-center div:nth-child(3){background:var(--yellow)}
.wild-center div:nth-child(4){background:var(--green)}
.wild-val{
  position:absolute;z-index:3;
  font-family:'Russo One',sans-serif;
  color:#fff;text-shadow:1px 2px 0 rgba(0,0,0,.5);
  font-size:1.4em;top:50%;left:50%;transform:translate(-50%,-50%);
}

/* ==================== PLAYER HAND (BOTTOM) ==================== */
.my-section{
  position:relative;padding:0 16px 10px;z-index:30;
}
.my-label{
  display:flex;align-items:center;justify-content:space-between;
  padding:4px 16px;font-size:.65rem;color:rgba(255,255,255,.4);
  text-transform:uppercase;letter-spacing:1px;
}
.my-label .star{color:#EAB308;font-size:.7rem}
.my-label.is-turn{color:var(--green);text-shadow:0 0 10px rgba(46,204,113,.5)}
.my-label-right{display:flex;align-items:center;gap:8px}

.my-hand-wrap{
  display:flex;justify-content:center;position:relative;
  min-height:calc(var(--card-h) + 20px);padding:0 20px;
  overflow-x:auto;scrollbar-width:none;
}
.my-hand-wrap::-webkit-scrollbar{display:none}

.my-hand{
  display:flex;justify-content:center;position:relative;
  min-height:var(--card-h);
}

.hand-card{
  width:var(--card-w);height:var(--card-h);
  position:relative;flex-shrink:0;cursor:pointer;
  transition:all .2s cubic-bezier(.4,0,.2,1);
  z-index:1;
}
.hand-card:hover{
  transform:translateY(-22px) scale(1.06);z-index:50!important;
}
.hand-card:active{transform:translateY(-10px) scale(1.02)}
.hand-card.no-play{opacity:.5;cursor:not-allowed}
.hand-card.no-play:hover{transform:translateY(-6px) scale(1.01)}
.hand-card .uno-card{width:100%;height:100%}
.hand-card.dealing{animation:cardDeal .35s ease backwards}

/* Hand overlap */
.my-hand .hand-card{margin-left:-20px}
.my-hand .hand-card:first-child{margin-left:0}

/* ==================== BUTTONS OVERLAY ==================== */
.game-actions{
  position:absolute;bottom:10px;right:16px;z-index:40;
  display:flex;gap:6px;
}

/* ==================== TURN GLOW ON BOARD ==================== */
.my-turn-glow{
  position:absolute;bottom:0;left:0;right:0;height:4px;
  background:linear-gradient(90deg,transparent,var(--green),transparent);
  opacity:0;transition:opacity .3s;
}
.my-turn-glow.on{opacity:1;animation:shimmer 2s linear infinite;
  background-size:200% 100%;
  background-image:linear-gradient(90deg,transparent 0%,var(--green) 50%,transparent 100%);
}

/* ==================== STATUS BAR ==================== */
.status-bar{
  position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  z-index:25;pointer-events:none;
}
.status-msg{
  background:rgba(0,0,0,.6);backdrop-filter:blur(8px);
  border:1px solid rgba(255,255,255,.08);border-radius:20px;
  padding:6px 18px;font-size:.72rem;color:rgba(255,255,255,.6);
  white-space:nowrap;animation:fadeIn .3s ease;
}
.status-msg strong{color:#fff}

/* ==================== MODALS ==================== */
.modal-bg{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(6px);z-index:1000;align-items:center;justify-content:center}
.modal-bg.show{display:flex}
.modal{background:rgba(13,21,37,.96);border:1px solid rgba(255,255,255,.1);border-radius:18px;padding:28px;text-align:center;animation:scaleIn .3s ease;max-width:320px;width:90%}
.modal h3{font-size:1rem;font-weight:700;margin-bottom:18px}
.color-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.color-pick{
  width:100%;height:65px;border-radius:12px;border:3px solid transparent;
  cursor:pointer;transition:all .25s;position:relative;overflow:hidden;
}
.color-pick:hover{transform:scale(1.08);border-color:rgba(255,255,255,.5)}
.color-pick::after{
  content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,rgba(255,255,255,.15),transparent);
}
.cp-red{background:var(--red);box-shadow:0 4px 15px rgba(220,38,38,.3)}
.cp-blue{background:var(--blue);box-shadow:0 4px 15px rgba(37,99,235,.3)}
.cp-green{background:var(--green);box-shadow:0 4px 15px rgba(22,163,74,.3)}
.cp-yellow{background:var(--yellow);box-shadow:0 4px 15px rgba(234,179,8,.3)}

/* ==================== WINNER ==================== */
#winner-overlay{display:none;position:fixed;inset:0;z-index:2000;background:rgba(0,0,0,.85);backdrop-filter:blur(10px);align-items:center;justify-content:center;flex-direction:column}
#winner-overlay.show{display:flex}
.win-box{text-align:center;animation:scaleIn .5s ease}
.win-trophy{font-size:5rem;animation:float 2s ease infinite}
.win-title{font-family:'Russo One',sans-serif;font-size:2.5rem;color:#EAB308;margin:8px 0}
.win-sub{font-size:1rem;color:rgba(255,255,255,.6);margin-bottom:24px}

/* ==================== TOASTS ==================== */
.toast-area{position:fixed;top:14px;right:14px;z-index:999;display:flex;flex-direction:column;gap:6px;pointer-events:none;max-width:260px}
.toast{
  background:rgba(13,21,37,.92);border:1px solid rgba(255,255,255,.1);
  border-radius:10px;padding:8px 14px;font-size:.75rem;
  display:flex;align-items:center;gap:6px;animation:fadeIn .25s ease;
  backdrop-filter:blur(8px);pointer-events:auto;
}
.toast.out{opacity:0;transform:translateY(-8px);transition:all .25s}

/* ==================== RESPONSIVE ==================== */
@media(max-width:700px){
  :root{--card-w:85px;--card-h:125px;--card-w-sm:65px;--card-h-sm:95px;--back-w:50px;--back-h:72px}
  .menu-logo{font-size:3.5rem}
  .panel{padding:22px}
  .opponents-section{gap:12px;padding:6px 10px 0}
  .opp-hand{height:var(--back-h);min-width:80px}
  .piles{gap:10px}
  .my-hand .hand-card{margin-left:-24px}
  .hand-card:hover{transform:translateY(-16px) scale(1.05)}
  .card-center-val{font-size:1.5em}
  .dir-arrow svg{width:28px;height:28px}
  .diamond{width:22px;height:22px}
  .game-actions{bottom:8px;right:10px}
  .quit-btn{top:8px;left:8px;padding:6px 10px;font-size:.65rem}
}
@media(max-width:420px){
  :root{--card-w:72px;--card-h:108px;--card-w-sm:58px;--card-h-sm:84px;--back-w:42px;--back-h:60px}
  .my-hand .hand-card{margin-left:-28px}
  .opponents-section{gap:8px}
}
</style>
</head>
<body>
<div class="menu-bg"></div>

<!-- =============== MENU =============== -->
<div class="screen active" id="menu-screen">
  <div class="menu-logo"><span class="logo-u">U</span><span class="logo-n">N</span><span class="logo-o">O</span></div>
  <div class="menu-sub">Online Multiplayer</div>
  <div class="panel">
    <h2>üåê Play with Friends</h2>
    <div class="field"><span class="fi">üë§</span><input type="text" id="my-name" placeholder="Your Name" maxlength="15"></div>
    <div class="tabs">
      <div class="tab on" onclick="switchTab('create')" id="tab-create">Create Room</div>
      <div class="tab" onclick="switchTab('join')" id="tab-join">Join Room</div>
    </div>
    <div id="p-create">
      <div class="field"><span class="fi">üë•</span>
        <select id="max-players">
          <option value="2">2 Players</option><option value="3">3 Players</option>
          <option value="4">4 Players</option><option value="5" selected>5 Players</option>
          <option value="6">6 Players</option><option value="7">7 Players</option>
          <option value="8">8 Players</option>
        </select>
      </div>
      <button class="btn btn-blue" onclick="createRoom()">üéÆ Create Room</button>
    </div>
    <div id="p-join" style="display:none">
      <div class="field"><span class="fi">üîë</span><input type="text" id="join-code" placeholder="Room Code" maxlength="8" style="text-transform:uppercase"></div>
      <button class="btn btn-green" onclick="joinRoom()">üö™ Join Room</button>
    </div>
    <div id="conn-status"></div>
  </div>
</div>

<!-- =============== LOBBY =============== -->
<div class="screen" id="lobby-screen">
  <div class="menu-logo" style="font-size:2.5rem"><span class="logo-u">U</span><span class="logo-n">N</span><span class="logo-o">O</span></div>
  <div class="menu-sub">Waiting Room</div>
  <div class="panel">
    <div class="code-box">
      <label>Room Code</label>
      <div class="code" id="lobby-code"></div>
      <div class="copy" onclick="copyCode()">üìã Tap to copy</div>
    </div>
    <p id="lobby-count"></p>
    <div class="lobby-list" id="lobby-list"></div>
    <p class="dots" style="text-align:center;font-size:.8rem;color:rgba(255,255,255,.4)">Waiting<span>.</span><span>.</span><span>.</span></p>
    <button class="btn btn-green" id="start-btn" onclick="hostStart()" style="display:none;margin-top:12px">üöÄ Start Game</button>
  </div>
</div>

<!-- =============== GAME =============== -->
<div class="screen" id="game-screen">
  <div class="game-board">
    <button class="quit-btn" onclick="backToMenu()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M18 6L6 18M6 6l12 12"/></svg>
      QUIT
    </button>

    <!-- Opponents -->
    <div class="opponents-section" id="opp-section"></div>

    <!-- Center -->
    <div class="center-area">
      <div class="color-diamond" id="color-diamond">
        <div class="diamond" id="cur-diamond"></div>
        <div class="clabel" id="cur-clabel"></div>
      </div>

      <div class="piles">
        <div class="draw-pile" onclick="onDraw()" id="draw-pile-el">
          <div class="draw-stack">
            <div class="card-back" style="position:absolute;top:6px;left:4px;z-index:1;opacity:.4"><div class="card-back-inner"></div></div>
            <div class="card-back" style="position:absolute;top:3px;left:2px;z-index:2;opacity:.7"><div class="card-back-inner"></div></div>
            <div class="card-back" style="position:absolute;top:0;left:0;z-index:3"><div class="card-back-inner"></div></div>
          </div>
          <div class="draw-count" id="draw-count"></div>
        </div>
        <div class="discard-pile" id="discard-el"></div>
      </div>

      <div class="dir-arrow" id="dir-arrow-el">
        <svg viewBox="0 0 48 48" fill="none">
          <path d="M8 24h28M28 16l10 8-10 8" stroke="rgba(139,92,246,0.8)" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>

      <div class="status-bar" id="status-bar"></div>
    </div>

    <!-- My Hand -->
    <div class="my-section">
      <div class="my-turn-glow" id="my-glow"></div>
      <div class="my-label" id="my-label">
        <span id="my-name-label">YOU</span>
        <div class="my-label-right">
          <span id="my-score">0 <span class="star">‚òÖ</span></span>
        </div>
      </div>
      <div class="my-hand-wrap">
        <div class="my-hand" id="my-hand"></div>
      </div>
    </div>

    <div class="game-actions">
      <button class="btn btn-red btn-sm" id="uno-btn" onclick="callUno()" disabled>UNO!</button>
      <button class="btn btn-ghost btn-sm" id="pass-btn" onclick="passAction()" disabled style="background:rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.1)">Pass ‚è≠</button>
    </div>
  </div>
</div>

<!-- =============== COLOR MODAL =============== -->
<div class="modal-bg" id="color-modal">
  <div class="modal">
    <h3>üé® Choose Color</h3>
    <div class="color-grid">
      <div class="color-pick cp-red" onclick="pickColor('red')"></div>
      <div class="color-pick cp-blue" onclick="pickColor('blue')"></div>
      <div class="color-pick cp-green" onclick="pickColor('green')"></div>
      <div class="color-pick cp-yellow" onclick="pickColor('yellow')"></div>
    </div>
  </div>
</div>

<!-- =============== WINNER =============== -->
<div id="winner-overlay">
  <div class="win-box">
    <div class="win-trophy">üèÜ</div>
    <div class="win-title">WINNER!</div>
    <div class="win-sub" id="win-sub"></div>
    <button class="btn btn-green" style="max-width:200px;margin:auto" onclick="backToMenu()">üîÑ Play Again</button>
  </div>
</div>

<!-- =============== TOASTS =============== -->
<div class="toast-area" id="toast-area"></div>

<script>
// =============================================
// UNO ONLINE - P2P MULTIPLAYER ENGINE
// =============================================
const COLORS=['red','blue','green','yellow'];
const VALUES=['0','1','2','3','4','5','6','7','8','9','Skip','Reverse','Draw2'];
const EMOJIS=['ü¶ä','üê±','üê∂','ü¶Å','üê∏','üêµ','üêº','üê∞','ü¶Ñ','üêØ'];
const PCOLS=['#e74c3c','#3498db','#2ecc71','#f1c40f','#9b59b6','#e67e22','#1abc9c','#e84393'];

let peer=null,connections=[],hostConn=null,isHost=false,myId='',roomCode='',maxP=5;
let G=null,myIdx=-1;

// ========== UI ==========
function show(id){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active')}
function switchTab(t){
  document.getElementById('tab-create').classList.toggle('on',t==='create');
  document.getElementById('tab-join').classList.toggle('on',t==='join');
  document.getElementById('p-create').style.display=t==='create'?'block':'none';
  document.getElementById('p-join').style.display=t==='join'?'block':'none';
}
function setStatus(m){document.getElementById('conn-status').textContent=m}
function toast(icon,msg){
  const a=document.getElementById('toast-area'),d=document.createElement('div');
  d.className='toast';d.innerHTML=`<span>${icon}</span><span>${msg}</span>`;
  a.appendChild(d);setTimeout(()=>{d.classList.add('out');setTimeout(()=>d.remove(),250)},3000);
}
function copyCode(){navigator.clipboard.writeText(roomCode).then(()=>toast('üìã','Copied!')).catch(()=>{})}
function genCode(){const c='ABCDEFGHJKLMNPQRSTUVWXYZ23456789';let s='';for(let i=0;i<6;i++)s+=c[Math.floor(Math.random()*c.length)];return s}

// ========== PEER ==========
function initPeer(id){
  return new Promise((res,rej)=>{
    peer=new Peer(id,{config:{iceServers:[{urls:'stun:stun.l.google.com:19302'},{urls:'stun:stun1.l.google.com:19302'}]}});
    peer.on('open',pid=>{myId=pid;res(pid)});
    peer.on('error',err=>{rej(err.type==='unavailable-id'?'Code taken':err.message||'Error')});
  });
}

// ========== CREATE ==========
async function createRoom(){
  const name=document.getElementById('my-name').value.trim()||'Host';
  maxP=+document.getElementById('max-players').value;
  roomCode=genCode();isHost=true;setStatus('Creating...');
  try{await initPeer('UNO-'+roomCode)}catch(e){setStatus('Error: '+e);return}
  connections=[];myIdx=0;
  window._lobby={players:[{name,emoji:EMOJIS[0],color:PCOLS[0],peerId:myId,index:0}],maxP,started:false};
  peer.on('connection',cn=>{cn.on('open',()=>{cn.on('data',d=>hostMsg(cn,d))});cn.on('close',()=>hostDC(cn))});
  document.getElementById('lobby-code').textContent=roomCode;
  show('lobby-screen');renderLobby();
}

function hostMsg(cn,d){
  const L=window._lobby;
  if(d.type==='join'){
    if(L.started){cn.send({type:'error',msg:'Game started'});return}
    if(L.players.length>=L.maxP){cn.send({type:'error',msg:'Room full'});return}
    const i=L.players.length;
    const p={name:d.name,emoji:EMOJIS[i%EMOJIS.length],color:PCOLS[i%PCOLS.length],peerId:cn.peer,index:i};
    L.players.push(p);cn._pi=i;connections.push(cn);
    bcastLobby();renderLobby();toast('üëã',d.name+' joined!');
  }
  if(d.type==='action'&&G)handleAction(cn._pi,d);
}
function hostDC(cn){
  const i=connections.indexOf(cn);if(i>-1)connections.splice(i,1);
  if(!window._lobby.started){
    const pi=cn._pi;if(pi!=null){
      const p=window._lobby.players.find(x=>x.index===pi);if(p)toast('üëã',p.name+' left');
      window._lobby.players=window._lobby.players.filter(x=>x.index!==pi);
      window._lobby.players.forEach((x,j)=>x.index=j);
      connections.forEach((c,j)=>{c._pi=j+1});
      bcastLobby();renderLobby();
    }
  }
}
function bcastLobby(){connections.forEach(c=>c.send({type:'lobby',players:window._lobby.players,maxP:window._lobby.maxP,yi:c._pi}))}
function bcastState(){
  if(!G)return;
  G.players.forEach((p,i)=>{if(p.hand.length>2)p.calledUno=false});
  connections.forEach(c=>{if(c._pi!=null)c.send({type:'gs',s:sanFor(c._pi)})});
  myIdx=0;renderGame(sanFor(0));
}
function bcastToast(ic,ms){toast(ic,ms);connections.forEach(c=>c.send({type:'toast',icon:ic,msg:ms}))}

function sanFor(pi){
  return{
    players:G.players.map((p,i)=>({name:p.name,emoji:p.emoji,color:p.color,index:p.index,
      hc:p.hand.length,hand:i===pi?p.hand:[],uno:p.calledUno})),
    cp:G.currentPlayer,dir:G.direction,
    dt:G.discardPile[G.discardPile.length-1],
    cc:G.currentColor,cv:G.currentValue,
    dpc:G.drawPile.length,hd:G.currentPlayer===pi?G.hasDrawn:false,
    yi:pi,winner:G.winner
  };
}

// ========== JOIN ==========
async function joinRoom(){
  const name=document.getElementById('my-name').value.trim()||'Player';
  const code=document.getElementById('join-code').value.trim().toUpperCase();
  if(!code){setStatus('Enter code');return}
  roomCode=code;isHost=false;setStatus('Connecting...');
  try{await initPeer(undefined)}catch(e){setStatus('Error: '+e);return}
  const cn=peer.connect('UNO-'+roomCode,{reliable:true});hostConn=cn;
  cn.on('open',()=>{cn.send({type:'join',name});setStatus('Joined!')});
  cn.on('data',d=>{
    if(d.type==='lobby'){myIdx=d.yi;window._lobby={players:d.players,maxP:d.maxP};show('lobby-screen');document.getElementById('lobby-code').textContent=roomCode;renderLobby()}
    if(d.type==='gs'){show('game-screen');myIdx=d.s.yi;renderGame(d.s)}
    if(d.type==='toast')toast(d.icon,d.msg);
    if(d.type==='error'){setStatus(d.msg);toast('‚õî',d.msg)}
  });
  cn.on('close',()=>{toast('‚ö†Ô∏è','Disconnected');setStatus('Disconnected')});
  cn.on('error',e=>setStatus('Error: '+e.message));
}

// ========== LOBBY ==========
function renderLobby(){
  const L=window._lobby;if(!L)return;
  const c=document.getElementById('lobby-list');c.innerHTML='';
  L.players.forEach((p,i)=>{
    const d=document.createElement('div');d.className='lp';
    d.innerHTML=`<div class="lp-ava" style="background:${p.color}">${p.emoji}</div><div class="lp-name">${p.name}</div>${i===0?'<div class="lp-badge">HOST</div>':''}`;
    c.appendChild(d);
  });
  document.getElementById('lobby-count').textContent=L.players.length+' / '+L.maxP+' players';
  document.getElementById('start-btn').style.display=(isHost&&L.players.length>=2)?'block':'none';
}

// ========== DECK ==========
let _u=0;function uid(){return 'c'+(++_u)}
function mkDeck(){
  let d=[];
  COLORS.forEach(c=>{d.push({color:c,value:'0',id:uid()});for(let v=1;v<VALUES.length;v++){d.push({color:c,value:VALUES[v],id:uid()});d.push({color:c,value:VALUES[v],id:uid()})}});
  for(let i=0;i<4;i++){d.push({color:'wild',value:'Wild',id:uid()});d.push({color:'wild',value:'WildDraw4',id:uid()})}
  return d;
}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}

// ========== START ==========
function hostStart(){
  if(!isHost)return;
  window._lobby.started=true;
  G={players:window._lobby.players.map(p=>({...p,hand:[],calledUno:false})),
    currentPlayer:0,direction:1,drawPile:shuffle(mkDeck()),discardPile:[],
    currentColor:'',currentValue:'',hasDrawn:false,winner:null};
  G.players.forEach(p=>{for(let i=0;i<7;i++)p.hand.push(G.drawPile.pop())});
  let st;do{
    st=G.drawPile.pop();
    if(st.color==='wild'||['Skip','Reverse','Draw2'].includes(st.value)){G.drawPile.unshift(st);G.drawPile=shuffle(G.drawPile);st=null}
  }while(!st);
  G.discardPile.push(st);G.currentColor=st.color;G.currentValue=st.value;
  show('game-screen');bcastState();bcastToast('üéÆ','Game started!');
}

// ========== CARD HELPERS ==========
function dv(v){switch(v){case'Skip':return'‚äò';case'Reverse':return'‚ü≤';case'Draw2':return'+2';case'Wild':return'W';case'WildDraw4':return'+4';default:return v}}
function canPlay(c,s){if(c.color==='wild')return true;if(c.color===s.cc)return true;if(c.value===s.cv)return true;return false}
function cardLabel(c){if(c.color==='wild')return c.value==='WildDraw4'?'Wild +4':'Wild';return c.color+' '+dv(c.value)}

// ========== BUILD CARD HTML ==========
function buildCard(card,cls=''){
  const col=card.color;const val=dv(card.value);
  const isWild=col==='wild';
  let html=`<div class="uno-card ${cls}" data-color="${col}"><div class="card-face">`;
  if(isWild){
    html+=`<div class="card-corner tl" style="color:#fff">${val}</div>`;
    html+=`<div class="wild-center"><div></div><div></div><div></div><div></div></div>`;
    html+=`<div class="wild-val">${val}</div>`;
    html+=`<div class="card-corner br" style="color:#fff">${val}</div>`;
  } else {
    html+=`<div class="card-corner tl">${val}</div>`;
    html+=`<div class="card-center"><div class="card-center-val">${val}</div></div>`;
    html+=`<div class="card-corner br">${val}</div>`;
  }
  html+=`</div></div>`;
  return html;
}

function buildCardBack(){
  return `<div class="card-back"><div class="card-back-inner"></div></div>`;
}

// ========== ACTIONS ==========
function handleAction(pi,d){
  if(!G||G.winner!=null)return;
  if(d.action==='play'){
    if(G.currentPlayer!==pi)return;
    const p=G.players[pi],ci=d.ci;
    if(ci<0||ci>=p.hand.length)return;
    const c=p.hand[ci];if(!canPlay(c,{cc:G.currentColor,cv:G.currentValue}))return;
    p.hand.splice(ci,1);G.discardPile.push(c);G.currentValue=c.value;G.hasDrawn=false;
    if(c.color==='wild'){
      G._pw={pi,card:c};
      if(pi===0){bcastState();document.getElementById('color-modal').classList.add('show')}
      else{const cn=connections.find(x=>x._pi===pi);if(cn)cn.send({type:'gs',s:{...sanFor(pi),pickColor:true}});
        G.players.forEach((x,i)=>{if(i!==pi){if(i===0)renderGame(sanFor(0));else{const cc=connections.find(x=>x._pi===i);if(cc)cc.send({type:'gs',s:sanFor(i)})}}});
      }
      bcastToast('üÉè',p.name+' played '+cardLabel(c));return;
    }
    G.currentColor=c.color;bcastToast('üÉè',p.name+' played '+cardLabel(c));
    applyFx(c);checkWin(p);bcastState();
  }
  if(d.action==='pickColor'){
    if(!G._pw||G._pw.pi!==pi)return;
    G.currentColor=d.color;const c=G._pw.card;delete G._pw;
    bcastToast('üé®','Color ‚Üí '+d.color.toUpperCase());
    applyFx(c);checkWin(G.players[pi]);bcastState();
  }
  if(d.action==='draw'){
    if(G.currentPlayer!==pi||G.hasDrawn)return;
    const p=G.players[pi];dealTo(p);G.hasDrawn=true;
    bcastToast('üÉè',p.name+' drew a card');bcastState();
  }
  if(d.action==='pass'){
    if(G.currentPlayer!==pi||!G.hasDrawn)return;
    G.hasDrawn=false;bcastToast('‚è≠',G.players[pi].name+' passed');advTurn();bcastState();
  }
  if(d.action==='uno'){
    const p=G.players[pi];if(p.hand.length<=2){p.calledUno=true;bcastToast('üî¥',p.name+' called UNO!');bcastState()}
  }
}

function applyFx(c){
  if(c.value==='Skip'){advTurn();advTurn()}
  else if(c.value==='Reverse'){G.direction*=-1;if(G.players.length===2){advTurn();advTurn()}else advTurn()}
  else if(c.value==='Draw2'){advTurn();const n=G.players[G.currentPlayer];dealTo(n);dealTo(n);bcastToast('üÉè',n.name+' draws 2!');advTurn()}
  else if(c.value==='WildDraw4'){advTurn();const n=G.players[G.currentPlayer];for(let i=0;i<4;i++)dealTo(n);bcastToast('üÉè',n.name+' draws 4!');advTurn()}
  else advTurn();
}
function advTurn(){G.currentPlayer=(G.currentPlayer+G.direction+G.players.length)%G.players.length;G.hasDrawn=false}
function dealTo(p){if(G.drawPile.length===0)reshuffle();if(G.drawPile.length===0)return;p.hand.push(G.drawPile.pop())}
function reshuffle(){if(G.discardPile.length<=1)return;const t=G.discardPile.pop();G.drawPile=shuffle(G.discardPile);G.discardPile=[t]}
function checkWin(p){if(p.hand.length===0){G.winner=p.index;bcastState()}}

function send(d){if(isHost)handleAction(0,d);else if(hostConn&&hostConn.open)hostConn.send({type:'action',...d})}
function onDraw(){send({action:'draw'})}
function passAction(){send({action:'pass'})}
function callUno(){send({action:'uno'})}
function onCard(i){send({action:'play',ci:i})}
function pickColor(c){document.getElementById('color-modal').classList.remove('show');send({action:'pickColor',color:c})}

// ========== RENDER GAME ==========
function renderGame(s){
  if(!s)return;
  if(s.pickColor){document.getElementById('color-modal').classList.add('show')}
  const me=s.yi,isMyTurn=s.cp===me;

  // Opponents
  const oSec=document.getElementById('opp-section');oSec.innerHTML='';
  s.players.forEach((p,i)=>{
    if(i===me)return;
    const isTurn=i===s.cp;const cnt=p.hc||p.hand?.length||0;
    const slot=document.createElement('div');slot.className='opponent-slot';
    // Label
    let labelHtml=`<div class="opp-label${isTurn?' is-turn'}">${p.name.toUpperCase()}`;
    labelHtml+=`</div>`;
    // Cards
    let cardsHtml=`<div class="opp-hand" style="width:${Math.min(cnt*18+52,220)}px">`;
    for(let c=0;c<cnt;c++){
      const left=c*Math.min(18,160/Math.max(cnt,1));
      cardsHtml+=`<div class="card-back" style="left:${left}px;z-index:${c}"><div class="card-back-inner"></div></div>`;
    }
    if(cnt===1&&p.uno)cardsHtml+=`<div class="opp-uno">UNO</div>`;
    cardsHtml+=`</div>`;
    slot.innerHTML=labelHtml+cardsHtml;
    oSec.appendChild(slot);
  });

  // Direction
  const dEl=document.getElementById('dir-arrow-el');
  dEl.classList.toggle('ccw',s.dir===-1);

  // Color diamond
  const dm=document.getElementById('cur-diamond');
  dm.className='diamond d-'+s.cc;
  document.getElementById('cur-clabel').textContent=s.cc?s.cc.toUpperCase():'';

  // Draw count
  document.getElementById('draw-count').textContent=s.dpc+' cards';

  // Discard
  const dA=document.getElementById('discard-el');
  if(s.dt){
    const dispColor=s.dt.color==='wild'?s.cc:s.dt.color;
    // For wild displayed with chosen color
    let cardHtml;
    if(s.dt.color==='wild'){
      cardHtml=buildCard(s.dt,'discard-top');
    } else {
      cardHtml=buildCard(s.dt,'discard-top');
    }
    dA.innerHTML=cardHtml;
  }

  // Status
  const sb=document.getElementById('status-bar');
  const cpN=s.players[s.cp].name;
  if(isMyTurn){
    sb.innerHTML=s.hd?`<div class="status-msg">Play a card or <strong>Pass</strong></div>`:`<div class="status-msg"><strong>Your turn!</strong> Play or Draw</div>`;
  } else {
    sb.innerHTML=`<div class="status-msg">Waiting for <strong>${cpN}</strong></div>`;
  }

  // Glow
  document.getElementById('my-glow').classList.toggle('on',isMyTurn);

  // My hand
  const mp=s.players[me];
  document.getElementById('my-name-label').textContent=mp.name.toUpperCase();
  const myHand=mp.hand||[];
  document.getElementById('my-hand').innerHTML='';
  const handEl=document.getElementById('my-hand');
  const canPlayAny=isMyTurn&&!s.hd;
  const canPlayDrawn=isMyTurn&&s.hd;

  myHand.forEach((card,idx)=>{
    const playable=canPlayAny?canPlay(card,s):(canPlayDrawn?canPlay(card,s):false);
    const d=document.createElement('div');
    d.className='hand-card'+(playable?'':' no-play')+' dealing';
    d.style.animationDelay=(idx*0.04)+'s';
    d.style.zIndex=idx;
    d.innerHTML=buildCard(card);
    if(playable)d.onclick=()=>onCard(idx);
    handEl.appendChild(d);
  });

  // My label
  document.getElementById('my-label').classList.toggle('is-turn',isMyTurn);

  // Buttons
  document.getElementById('uno-btn').disabled=!(isMyTurn&&myHand.length===2);
  document.getElementById('pass-btn').disabled=!(isMyTurn&&s.hd);

  // Winner
  if(s.winner!=null){
    const w=s.players[s.winner];
    document.getElementById('win-sub').textContent=w.emoji+' '+w.name+' wins the game!';
    document.getElementById('winner-overlay').classList.add('show');
    spawnConfetti();
  }
}

function spawnConfetti(){
  const cols=['#e74c3c','#3498db','#2ecc71','#f1c40f','#9b59b6','#e67e22','#1abc9c','#e84393'];
  for(let i=0;i<60;i++){
    const el=document.createElement('div');
    el.style.cssText=`position:fixed;width:${6+Math.random()*12}px;height:${6+Math.random()*12}px;top:-10px;left:${Math.random()*100}vw;background:${cols[Math.floor(Math.random()*cols.length)]};border-radius:${Math.random()>.5?'50%':'2px'};z-index:2001;animation:confetti ${2+Math.random()*3}s linear ${Math.random()*2}s forwards;`;
    document.body.appendChild(el);
    setTimeout(()=>el.remove(),7000);
  }
}

function backToMenu(){
  document.getElementById('winner-overlay').classList.remove('show');
  document.getElementById('color-modal').classList.remove('show');
  if(peer){peer.destroy();peer=null}
  connections=[];hostConn=null;isHost=false;G=null;myIdx=-1;window._lobby=null;
  show('menu-screen');
}

// ========== SOUND FX ==========
const AC=window.AudioContext||window.webkitAudioContext;
let actx;
function sfx(type){
  try{
    if(!actx)actx=new AC();
    const o=actx.createOscillator(),g=actx.createGain();
    o.connect(g);g.connect(actx.destination);g.gain.value=0.07;
    const t=actx.currentTime;
    switch(type){
      case'play':o.frequency.value=520;o.type='sine';g.gain.exponentialRampToValueAtTime(.001,t+.12);o.start();o.stop(t+.12);break;
      case'draw':o.frequency.value=330;o.type='triangle';g.gain.exponentialRampToValueAtTime(.001,t+.1);o.start();o.stop(t+.1);break;
      case'uno':o.frequency.value=780;o.type='square';g.gain.value=.05;g.gain.exponentialRampToValueAtTime(.001,t+.25);o.start();o.stop(t+.25);break;
      case'win':
        o.frequency.value=440;o.type='sine';g.gain.exponentialRampToValueAtTime(.001,t+.4);o.start();o.stop(t+.4);
        setTimeout(()=>{
          const o2=actx.createOscillator(),g2=actx.createGain();
          o2.connect(g2);g2.connect(actx.destination);o2.frequency.value=660;o2.type='sine';
          g2.gain.value=.07;g2.gain.exponentialRampToValueAtTime(.001,actx.currentTime+.4);
          o2.start();o2.stop(actx.currentTime+.4);
        },180);
        setTimeout(()=>{
          const o3=actx.createOscillator(),g3=actx.createGain();
          o3.connect(g3);g3.connect(actx.destination);o3.frequency.value=880;o3.type='sine';
          g3.gain.value=.07;g3.gain.exponentialRampToValueAtTime(.001,actx.currentTime+.5);
          o3.start();o3.stop(actx.currentTime+.5);
        },360);
        break;
      case'turn':o.frequency.value=440;o.type='sine';g.gain.value=.04;g.gain.exponentialRampToValueAtTime(.001,t+.08);o.start();o.stop(t+.08);break;
    }
  }catch(e){}
}

// Wrap toast with sounds
const _ot=toast;
toast=function(ic,ms){
  _ot(ic,ms);
  if(ms.includes('played'))sfx('play');
  else if(ms.includes('drew'))sfx('draw');
  else if(ms.includes('UNO'))sfx('uno');
  else if(ms.includes('wins'))sfx('win');
  else if(ms.includes('Your turn')||ms.includes('started'))sfx('turn');
};

// ========== KEYBOARD ==========
document.addEventListener('keydown',e=>{
  if(e.key==='u'||e.key==='U')callUno();
  if(e.key==='p'||e.key==='P')passAction();
  if(e.key==='d'||e.key==='D')onDraw();
});

// ========== ENTER KEY ==========
document.getElementById('my-name').addEventListener('keydown',e=>{
  if(e.key==='Enter'){
    if(document.getElementById('tab-create').classList.contains('on'))createRoom();
    else document.getElementById('join-code').focus();
  }
});
document.getElementById('join-code').addEventListener('keydown',e=>{if(e.key==='Enter')joinRoom()});

// ========== TURN TIMER (Auto-pass after 30s) ==========
let turnTimer=null,turnTimeout=30;
function startTurnTimer(){
  clearInterval(turnTimer);
  let left=turnTimeout;
  turnTimer=setInterval(()=>{
    left--;
    if(left<=0){
      clearInterval(turnTimer);
      if(isHost&&G&&G.winner==null){
        const cp=G.currentPlayer;
        if(!G.hasDrawn){dealTo(G.players[cp]);G.hasDrawn=true}
        G.hasDrawn=false;advTurn();
        bcastToast('‚è∞',G.players[cp]?.name+' timed out!');
        bcastState();
      }
    }
  },1000);
}

// ========== PREVENT ZOOM ==========
document.addEventListener('touchend',e=>{
  if(e.target.closest('.hand-card,.btn,.color-pick,.draw-pile,.tab'))e.preventDefault();
},{passive:false});

// ========== HANDLE VISIBILITY ==========
document.addEventListener('visibilitychange',()=>{
  if(!document.hidden&&peer&&peer.disconnected)peer.reconnect();
});

// ========== BEFOREUNLOAD ==========
window.addEventListener('beforeunload',e=>{
  if(G&&G.winner==null){e.preventDefault();e.returnValue='Game in progress!'}
});

// ========== MOBILE VIEWPORT FIX ==========
function fixVH(){document.documentElement.style.setProperty('--vh',window.innerHeight*.01+'px')}
window.addEventListener('resize',fixVH);fixVH();

// ========== INIT ==========
show('menu-screen');
document.getElementById('my-name').focus();

console.log('%cüé¥ UNO Online','font-size:20px;font-weight:bold;color:#e74c3c');
console.log('%cP2P Multiplayer via PeerJS','font-size:11px;color:#888');
</script>
</body>
</html>
